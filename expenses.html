<!DOCTYPE html>
<html lang="en" ng-app="expenseApp">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Spending</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

<style>
    body {
        background: linear-gradient(135deg, #eef0ff, #f7f8ff);
    }
    .box {
        max-width: 900px;
        margin: 40px auto;
        background: white;
        padding: 25px;
        border-radius: 14px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    }
    h3 {
        color: #3f3d8f;
        font-weight: 600;
    }
    .btn-theme {
        background-color: #5a58b6;
        color: white;
    }
    .btn-theme:hover {
        background-color: #4745a5;
        color: white;
    }
    .back-btn {
        margin-top: 20px;
        text-align: center;
    }
    .card input, .card select {
        border-radius: 6px;
    }
    table th, table td {
        vertical-align: middle !important;
    }
</style>
</head>

<body ng-controller="expenseCtrl">

<div class="box">

    <h3 class="mb-4 text-center">Monthly Spending</h3>

    <form ng-submit="addExpense()" class="card p-3 mb-4 shadow-sm border-0">

        <input type="text" ng-model="Title" placeholder="Expense Title" class="form-control mb-2" required>

        <input type="number" ng-model="Amount" placeholder="Amount" class="form-control mb-2" required>

        <select ng-model="Category" class="form-control mb-2" required>
            <option value="">Select Category</option>
            <option>Food</option>
            <option>Travel</option>
            <option>Shopping</option>
            <option>Housing</option>
            <option>Others</option>
        </select>

        <input type="date" ng-model="ExpenseDate" class="form-control mb-3" required>

        <button type="submit" class="btn btn-theme w-100">Add Expense</button>

    </form>

    <div class="alert alert-success text-center" ng-show="message">
        {{message}}
    </div>

    <table class="table table-bordered table-striped mt-4">
        <thead class="table-dark">
            <tr>
                <th>Title</th>
                <th>Amount</th>
                <th>Category</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="e in expenses">
                <td>{{e.Title}}</td>
                <td>â‚¹{{e.Amount}}</td>
                <td>{{e.Category}}</td>
                <td>{{e.ExpenseDate}}</td>
            </tr>
        </tbody>
    </table>

    <div class="back-btn">
        <a href="home.html" class="btn btn-secondary w-100">Back to Home</a>
    </div>

</div>

<script>
angular.module("expenseApp", [])
.controller("expenseCtrl", function($scope, $http){

    $http.get("get_expenses.php").then(function(res){
        $scope.expenses = res.data;
    });

    $scope.addExpense = function () {
        let data = {
            Title: $scope.Title,
            Amount: $scope.Amount,
            Category: $scope.Category,
            ExpenseDate: new Date($scope.ExpenseDate).toISOString().split('T')[0]
        };

        $http.post("add_expense.php", data)
        .then(function(res){
            if(res.data.status === "success"){
                $scope.message = "Expense added successfully";
                $scope.expenses.unshift(res.data.data);

                $scope.Title = "";
                $scope.Amount = "";
                $scope.Category = "";
                $scope.ExpenseDate = "";
            }
        });
    };

});
</script>

</body>
</html>
